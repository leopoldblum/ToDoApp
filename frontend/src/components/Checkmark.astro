---
const { todoEntry } = Astro.props;
const todoID = todoEntry.id;
---

<button id={`todoButton_${todoID}`} class="todoButtons" data-todoID={todoID}>
    iD: {todoID} is {JSON.stringify(todoEntry.fulfilled)}
</button>

<style>
    .todoButtons {
        padding: 25% 25%;
        margin: 5%;
        background-color: grey;
    }

    .todoButtons:hover {
        background-color: rgb(60, 219, 55);
    }
</style>

<script>
    async function toggleFulfillmentTodo(todoID: string | null) {
        if (todoID === null)
            throw new Error("todoID is null, cant update fulfillment!");

        const getDataResponse = await fetch(
            "http://localhost:8080/todo/" + todoID,
        );
        const myData = await getDataResponse.json();

        myData.fulfilled = !myData.fulfilled;

        const response = await fetch(
            "http://localhost:8080/updateTodo/" + todoID,
            {
                method: "POST",
                body: JSON.stringify(myData),
                headers: {
                    "Content-Type": "application/json",
                },
            },
        );

        console.log("Response: \n" + response);
        console.log("Response.json(): \n" + response.json);

        //console.log("did it update id=" + todoID + "? \n");
    }

    const allButtons = document.getElementsByClassName("todoButtons");

    for (let currButton of allButtons) {
        currButton.addEventListener("click", () =>
            toggleFulfillmentTodo(currButton.getAttribute("data-todoID")),
        );
    }
</script>
